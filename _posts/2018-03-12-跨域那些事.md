---
layout: post
title: "è·¨åŸŸé‚£äº›äº‹"
date: 2018-03-12
description: "è°ˆè°ˆè·¨åŸŸé‚£äº›äº‹"
tag: åˆæ ¼å‰ç«¯
--- 

## ä¸€ã€ä»€ä¹ˆæ˜¯è·¨åŸŸ

ç”±äºæµè§ˆå™¨å¯¹å®‰å…¨è®¿é—®å› ç´ çš„è€ƒè™‘ï¼Œæ˜¯ä¸å…è®¸ js è·¨åŸŸè°ƒç”¨å…¶ä»–é¡µé¢çš„ï¼Œè¿™é‡Œçš„åŸŸæˆ‘ä»¬æŠŠå®ƒæƒ³è±¡æˆåŸŸåï¼Œå¦‚ï¼Œä¸€ä¸ªåŸŸåä¸º https://www.oschina.net ï¼Œå¦å¤–ä¸€ä¸ªåŸŸåä¸º https://www.zhihu.com ï¼Œè¿™ä¸¤è€…å±äºä¸åŒçš„åŸŸåï¼Œå®ƒä»¬ä¹‹é—´çš„é¡µé¢ä¹Ÿæ˜¯ä¸èƒ½ç›¸äº’è°ƒç”¨çš„ï¼Œå®ƒå±äºåŒæºç­–ç•¥æ‰€å®šä¹‰é™åˆ¶ä¸­çš„ä¸€ç§ã€‚åŒæºç­–ç•¥å…·ä½“åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š

ä¸åŒåŸŸå
- ç›¸åŒåŸŸåä¸åŒç«¯å£å·ï¼Œå¦‚ https://www.oschina.net:8000 å’Œ https://www.oschina.net:8001
- åŒä¸€ä¸ªåŸŸåä¸åŒåè®®ï¼Œå¦‚ http://www.oschina.netå’Œhttps://www.oschina.net
- åŸŸåå’ŒåŸŸåå¯¹åº”çš„çš„ IPï¼Œå¦‚ http://b.qq.com å’Œ http://10.198.7.85
- ä¸»åŸŸå’Œå­åŸŸï¼Œå¦‚ http://www.oschina.net å’Œ https://test.oschina.net
- å­åŸŸå’Œå­åŸŸï¼Œå¦‚ https://test1.oschina.net å’Œ https://test2.oschina.net

ä»¥ä¸Šæƒ…å†µåªè¦å‡ºç°äº†ï¼Œé‚£ä¹ˆå°±ä¼šäº§ç”Ÿè·¨åŸŸé—®é¢˜ã€‚é‚£ä¹ˆå¦‚æœè§£å†³è·¨åŸŸé—®é¢˜å‘¢ï¼Œä¸‹é¢çš„å°èŠ‚ä¼šæ€»ç»“ä¸€äº›è§£å†³è·¨åŸŸå¸¸ç”¨çš„æ–¹æ³•

## äºŒã€è·¨åŸŸè§£å†³æ–¹æ¡ˆ

### 1ã€JSONP

å¯¹äº JSONP ï¼Œæœ‰ä¸ªé€šä¿—æ˜“æ‡‚çš„è§£é‡Š-JSONPï¼ˆJSON with Paddingï¼‰æ˜¯æ•°æ®æ ¼å¼ JSON çš„ä¸€ç§â€œä½¿ç”¨æ¨¡å¼â€ï¼Œå¯ä»¥è®©ç½‘é¡µä»åˆ«çš„ç½‘åŸŸè¦æ•°æ®ã€‚

ç”±äºåŒæºç­–ç•¥ï¼Œå¦‚ä¸Šæ‰€è¿°ã€‚ä½†æ˜¯ï¼ˆä¸­å›½äººè®²è¯æ˜¯å¾ˆæœ‰æ–‡åŒ–çš„ï¼‰ï¼Œ`HTML` çš„ `<script>` å…ƒç´ æ˜¯ä¸€ä¸ªä¾‹å¤–ï¼Œå®ƒå¹¶ä¸éµå¾ªåŒæºç­–ç•¥ï¼Œåˆ©ç”¨ `<script>` å…ƒç´ çš„è¿™ä¸ªå¼€æ”¾ç­–ç•¥ï¼Œç½‘é¡µå¯ä»¥å¾—åˆ°ä»å…¶ä»–æ¥æºåŠ¨æ€äº§ç”Ÿçš„ JSON æ•°æ®ï¼Œè€Œè¿™ç§ä½¿ç”¨æ¨¡å¼å°±æ˜¯æ‰€è°“çš„  JSONP ã€‚ç”¨ JSONP æŠ“åˆ°çš„æ•°æ®å¹¶ä¸æ˜¯ JSON ï¼Œè€Œæ˜¯ä»»æ„çš„JavaScriptï¼Œç”¨ JavaScriptè§£é‡Šå™¨è¿è¡Œè€Œä¸æ˜¯ç”¨ JSON è§£æå™¨è§£æã€‚æ¥æ¥æ¥ï¼Œæˆ‘æ¥ä¸¾ä¸ªæ —å­ ğŸŒ° å§
å‰ç«¯æµè§ˆå™¨é¡µé¢

```javascript
<script>
function jsonpCallBack (res, req) {
  console.log(res, req);
}
</script>
<script type="text/JavaScript" src="http://localhost/test/jsonp.php?callback=jsonpCallBack&data=getJsonpData"></script>
```

å¦ä¸€ä¸ªåŸŸåæœåŠ¡å™¨è¯·æ±‚æ¥å£

```php
<?php
  /*åç«¯è·å–è¯·æ±‚å­—æ®µæ•°æ®ï¼Œå¹¶ç”Ÿæˆè¿”å›å†…å®¹*/
  $data = $_GET["data"];
  $callback = $_GET["callback"];
  echo $callback."('success', '".$data."')";
?>
```

æµ‹è¯•ç»“æœå¦‚ä¸‹

![](/images/blog/0312/jsonp.png)

è¿™ç§æ–¹æ¡ˆéœ€è¦æ³¨æ„çš„æ˜¯ä»–æ”¯æŒ GET è¿™ä¸€ç§HTTPè¯·æ±‚ç±»å‹ï¼Œè¿˜æœ‰å°¤ä¸ºé‡è¦çš„å°±æ˜¯å…¶ä»–åŸŸè¦æœ‰ä¸€å®šå¯é æ€§ï¼Œä¸ç„¶ä½ çš„ç½‘ç«™ä¼š GG çš„ã€‚å½“ç„¶æœ‰æ—¶æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ä¸€ä¸ªæ–¹æ³•æ¥**åŠ¨æ€ç”Ÿæˆéœ€è¦çš„ JSONP**

### 2ã€è·¨åŸŸèµ„æºå…±äº«ï¼ˆCORS-Cross Origin Resource Sharingï¼‰

CORSï¼Œå®ƒæ˜¯ JSONP æ¨¡å¼çš„ç°ä»£å‡çº§ç‰ˆï¼Œä¸ JSONP ä¸åŒçš„æ˜¯ï¼ŒCORS é™¤äº† GET è¦æ±‚æ–¹æ³•ä»¥å¤–ä¹Ÿæ”¯æŒå…¶ä»–çš„ HTTP è¦æ±‚ã€‚æµè§ˆå™¨ CORS è¯·æ±‚åˆ†æˆä¸¤ç§

1. ç®€å•è¯·æ±‚
2. åå•†æ¨¡å‹/é¢„æ£€è¯·æ±‚ï¼ˆPreflighted Requestï¼‰ï¼Œå³éç®€å•è¯·æ±‚

å¦‚ä½•åŒºåˆ†è¯·æ±‚å…·ä½“å±äºå“ªä¸€ç§å‘¢ï¼Œä¸‹é¢æˆ‘æ€»ç»“äº†å‡ ç‚¹ï¼š

#### i. è¯·æ±‚æ–¹å¼

- GET
- HEAD
- POST

#### ii. HTTP çš„å¤´ä¿¡æ¯å­æ®µ

- Accept
- Accept-Language
- Content-Language
- Last-Event-ID
- Content-Typeï¼šåªé™äºä¸‰ä¸ªå€¼application/x-www-form-urlencodedã€multipart/form-dataã€text/plainï¼Œå…¶ä¸­'text/plain'é»˜è®¤æ”¯æŒï¼Œå…¶ä»–ä¸¤ç§åˆ™éœ€è¦é¢„æ£€è¯·æ±‚å’ŒæœåŠ¡å™¨åå•†

æ»¡è¶³ä»¥ä¸Šä¸¤å¤§ç‚¹çš„å³ä¸ºç®€å•è¯·æ±‚ï¼Œå¦åˆ™ä¸ºéç®€å•è¯·æ±‚ã€‚å…·ä½“è¯·æ±‚å¤„ç†çš„ä¸åŒï¼Œå¤§å®¶å¯ä»¥å»æŸ¥é˜…ä¸‹ MDN [https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS) ï¼Œé‚£é‡Œæœ‰è¯¦ç»†çš„è§£æåŠç”¨æ³•ã€‚

### 3ã€document.domain + iframeï¼ˆé€‚ç”¨äºä¸»åŸŸåç›¸åŒçš„æƒ…å†µï¼‰

ä»ä¸Šé¢çš„åŒæºç­–ç•¥æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œæµè§ˆå™¨è¿™è¾¹æ˜¯è®¤ä¸ºä¸»åŸŸå’Œå­åŸŸã€å­åŸŸå’Œå­åŸŸï¼Œå®ƒä»¬å±äºä¸åŒçš„åŸŸï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚æœéœ€è¦è®©ä¸»åŸŸå’Œå­åŸŸä¹‹é—´å¯ä»¥è¿›è¡Œé€šä¿¡ï¼Œéœ€è¦åšçš„å°±æ˜¯é€šè¿‡ä¿®æ”¹ document.domain ï¼ŒæŠŠå®ƒä»¬æ”¹æˆç›¸åŒçš„ domain

åœ¨åŸŸåä¸º server.example.com ä¸­çš„ a.html

```javascript
document.domain = 'example.com';
var $iframe = document.createElement('iframe');
$iframe.src = 'server.child.example.com/b.html';
$iframe.style.display = 'none';
document.body.appendChild($iframe);
$iframe.onload = function(){
    var doc = $iframe.contentDocument || $iframe.contentWindow.document;
    //åœ¨è¿™é‡Œæ“ä½œ docï¼Œä¹Ÿå°±æ˜¯æ“ä½œ b.html
    $iframe.onload = null;
};
```

åœ¨åŸŸåä¸º server.child.example.com ä¸­çš„ b.html

```javascript
document.domain = 'example.com'
```

è¿™ç§å½¢å¼æ–¹ä¾¿å½’æ–¹ä¾¿ï¼Œä½†ä¹Ÿæœ‰å…¶æ–¹ä¾¿å¸¦æ¥çš„éšæ‚£

- å®‰å…¨æ€§ï¼Œå½“ä¸€ä¸ªç«™ç‚¹è¢«æ”»å‡»åï¼Œå¦ä¸€ä¸ªç«™ç‚¹ä¼šå¼•èµ·å®‰å…¨æ¼æ´
- è‹¥é¡µé¢ä¸­å¼•å…¥å¤šä¸ª iframe ï¼Œè¦æƒ³æ“ä½œæ‰€æœ‰ iframe ï¼Œdomain éœ€è¦å…¨éƒ¨è®¾ç½®æˆä¸€æ ·çš„

### 4ã€window.name + iframe

window å¯¹è±¡çš„ name å±æ€§æ˜¯ä¸€ä¸ªå¾ˆç‰¹åˆ«çš„å±æ€§ï¼Œå®ƒå¯ä»¥åœ¨ä¸åŒé¡µé¢ç”šè‡³ä¸åŒåŸŸååŠ è½½åä¾æ—§å­˜åœ¨ã€‚ä½¿ç”¨æ­¥éª¤å¦‚ä¸‹ï¼š
1. é¦–å…ˆåœ¨é¡µé¢ A ä¸­åˆ©ç”¨ iframe åŠ è½½å…¶ä»–åŸŸä¸­çš„é¡µé¢ B
2. åœ¨é¡µé¢ B ä¸­å°†éœ€è¦ä¼ é€’çš„æ•°æ®èµ‹ç»™ window.name
3. iframe åŠ è½½å®Œæˆåï¼Œé¡µé¢ A ä¸­ä¿®æ”¹ iframe åœ°å€ï¼Œå°†å…¶å˜æˆåŒä¸€ä¸ªåŸŸä¸‹çš„åœ°å€ï¼Œç„¶åè·å– iframe ä¸­é¡µé¢ B çš„ window.name å±æ€§

ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š
é¦–å…ˆæˆ‘ä»¬åœ¨åŸŸåä¸º http://127.0.0.1 ä¸‹å»ºç«‹å¥½ B é¡µé¢ï¼Œåœ¨ B é¡µé¢çš„ `<script>` æ ‡ç­¾ä¸­å°†éœ€è¦ä¼ é€’çš„æ•°æ®èµ‹ç»™ window.name

```javascript
window.name = 'é¡µé¢Bä¸­ä¼ é€’ç»™é¡µé¢Açš„æ•°æ®';
```

ç„¶åæˆ‘ä»¬åŸŸåä¸º http://127.0.0.1:9000 çš„ A é¡µé¢ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦åšçš„ä¸€ä»¶äº‹å°±æ˜¯åˆ©ç”¨ iframe åŠ è½½é¡µé¢ Bï¼Œå¹¶å°†å…¶åŸŸåè¿›è¡Œä¿®æ”¹ï¼Œå˜æˆå’Œé¡µé¢ A ä¸€æ ·çš„åŸŸå

```javascript
function proxy (url, callback) {
  var flag = true
  var $iframe = document.createElement('iframe')
  var loadCallBack = function () {
    if (flag) {
      // è¿™é‡Œæˆ‘ä»¬è¿˜å¾—åœ¨åŸŸåä¸º http://127.0.0.1:9000 å»ºç«‹ä¸€ä¸ªtmp.htmlæ–‡ä»¶å½“åšç¼“å­˜ç•Œé¢
      $iframe.contentWindow.location = 'http://127.0.0.1:9000/tmp.html';
      flag = false;
    }
    // ä¿®æ”¹localtionåï¼Œæ¯æ¬¡è§¦å‘onloadäº‹ä»¶ä¼šé‡ç½®srcï¼Œç›¸å½“äºé‡æ–°è½½å…¥é¡µé¢ï¼Œç„¶åç»§ç»­è§¦å‘onloadã€‚
    // è¿™é‡Œæ˜¯é’ˆå¯¹è¯¥é—®é¢˜åšçš„å¤„ç†
    else {
      callback($iframe.contentWindow.name);
      $iframe.contentWindow.close();
      document.body.removeChild($iframe);
      $iframe.src = '';
      $iframe = null;
    }
  };

  $iframe.src = url;
  $iframe.style.display = 'none';
  // äº‹ä»¶ç»‘å®šå…¼å®¹ç®€å•å¤„ç†
  // IE æ”¯æŒiframeçš„onloadäº‹ä»¶ï¼Œä¸è¿‡æ˜¯éšå½¢çš„ï¼Œéœ€è¦é€šè¿‡attachEventæ¥æ³¨å†Œ
  if ($iframe.attachEvent) {
    $iframe.attachEvent('onload', loadCallBack);
  }
  else {
    $iframe.onload = loadCallBack;
  }

  document.body.appendChild($iframe);
}
proxy('http://127.0.0.1/bop/test.html', function(data){
  console.log(data);
});
```

æµ‹è¯•ç»“æœå¦‚å›¾

![](/images/blog/0312/jsonp2.png)

### 5ã€HTML5 ä¸­çš„ postMessageï¼ˆé€‚ç”¨äºä¸¤ä¸ª iframe æˆ–ä¸¤ä¸ªé¡µé¢ä¹‹é—´ï¼‰

`postMessage` éš¶å±äº `html5`ï¼Œä½†æ˜¯å®ƒæ”¯æŒ IE8+ å’Œå…¶ä»–æµè§ˆå™¨ï¼Œå¯ä»¥å®ç°åŒåŸŸä¼ é€’ï¼Œä¹Ÿèƒ½å®ç°è·¨åŸŸä¼ é€’ã€‚å®ƒåŒ…æ‹¬å‘é€æ¶ˆæ¯ `postMessage` å’Œæ¥æ”¶æ¶ˆæ¯ `message` åŠŸèƒ½ã€‚

`postMessage` è°ƒç”¨è¯­æ³•å¦‚ä¸‹

```javascript
otherWindow.postMessage(message, targetOrigin, [transfer])
```

- otherWindow ï¼š å…¶ä»–çª—å£çš„ä¸€ä¸ªå¼•ç”¨ï¼Œæ¯”å¦‚ `iframe` çš„ `contentWindow` å±æ€§ã€æ‰§è¡Œ `window.open` è¿”å›çš„çª—å£å¯¹è±¡ã€æˆ–è€…æ˜¯å‘½åè¿‡æˆ–æ•°å€¼ç´¢å¼•çš„ window.frames
- message ï¼š å°†è¦å‘é€åˆ°å…¶ä»– window çš„æ•°æ®ï¼Œç±»å‹ä¸º `string` æˆ–è€… `object`
- targetOrigin ï¼š é€šè¿‡çª—å£çš„ `origin` å±æ€§æ¥æŒ‡å®šå“ªäº›çª—å£èƒ½æ¥æ”¶åˆ°æ¶ˆæ¯äº‹ä»¶ï¼Œå…¶å€¼å¯ä»¥æ˜¯å­—ç¬¦ä¸²"*"ï¼ˆè¡¨ç¤ºæ— é™åˆ¶ï¼‰æˆ–è€…ä¸€ä¸ªURI
- transfer (å¯é€‰) ï¼š ä¸€ä¸²å’Œ message åŒæ—¶ä¼ é€’çš„ Transferable å¯¹è±¡

æ¥æ”¶æ¶ˆæ¯ message çš„å±æ€§æœ‰:

- data ï¼šä»å…¶ä»– window ä¸­ä¼ é€’è¿‡æ¥çš„æ•°æ®
- origin ï¼šè°ƒç”¨ postMessage  æ—¶æ¶ˆæ¯å‘é€æ–¹çª—å£çš„ origin 
- source ï¼šå¯¹å‘é€æ¶ˆæ¯çš„çª—å£å¯¹è±¡çš„å¼•ç”¨

ç¤ºä¾‹å¦‚ä¸‹ï¼šåŸŸå http://127.0.0.1:9000 é¡µé¢ A é€šè¿‡ `iframe` åµŒå…¥äº† http://127.0.0.1 é¡µé¢ Bï¼Œæ¥ä¸‹æ¥é¡µé¢ A å°†é€šè¿‡ `postMessage` å¯¹é¡µé¢ B è¿›è¡Œæ•°æ®ä¼ é€’ï¼Œé¡µé¢ B å°†é€šè¿‡ `message` å±æ€§æ¥æ”¶é¡µé¢ A çš„æ•°æ®

é¡µé¢ A å‘é€æ¶ˆæ¯ä»£ç 

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>é¡µé¢A</title>
</head>
<body>
  <h1>hello jsonp</h1>
  <iframe src="http://127.0.0.1/b.html" id="iframe"></iframe>
</body>
</html>
<script>
window.onload = function() {  
  var $iframe = document.getElementById('iframe');  
  var targetOrigin = "http://127.0.0.1";  
  $iframe.contentWindow.postMessage('postMessageå‘é€æ¶ˆæ¯', targetOrigin);  
}; 
</script>
```

é¡µé¢ B æ¥æ”¶æ¶ˆæ¯ä»£ç 

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>é¡µé¢B</title>
</head>
<body>
  <h1>hello jsonp</h1>
</body>
</html>
<script>
var onmessage = function (event) {
  var data = event.data;     //æ¶ˆæ¯
  var origin = event.origin; //æ¶ˆæ¯æ¥æºåœ°å€
  var source = event.source; //æºWindowå¯¹è±¡
  if(origin === "http://127.0.0.1:9000"){
    console.log(data, origin, source);
  }
};
// äº‹ä»¶å…¼å®¹ç®€å•å¤„ç†
if (window.addEventListener) {
  window.addEventListener('message', onmessage, false);
}
else if (window.attachEvent) {
  window.attachEvent('onmessage', onmessage);
}
else {
  window.onmessage = onmessage;
}
</script>
```

è¿è¡Œç»“æœå¦‚ä¸‹

![](/images/blog/0312/postMessage.png)

### 6ã€location.hash + iframeï¼ˆé€‚ç”¨äºä¸¤ä¸ª iframe ä¹‹é—´ï¼‰

å¯¹äº `location.hash`ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€å¼ å›¾å…ˆ

![](/images/blog/0312/hash.png)

ç›¸ä¿¡çœ‹å®Œå›¾ï¼Œå¤§å®¶ä¹Ÿå¤§æ¦‚æ¸…æ¥šäº† `location.hash` åˆ°åº•æ˜¯ç”¨æ¥å¹²å•¥å­çš„ã€‚æ²¡é”™ï¼Œå®ƒå¯ä»¥ç”¨æ¥è·å–æˆ–è®¾ç½®é¡µé¢çš„æ ‡ç­¾å€¼ å¦‚ http://127.0.0.1:9000/#hello ï¼Œå®ƒçš„ `location.hash` å€¼åˆ™ä¸º '#hello'ã€‚å®ƒä¸€èˆ¬ç”¨äºæµè§ˆå™¨é”šç‚¹å®šä½ï¼ŒHTTP è¯·æ±‚è¿‡ç¨‹ä¸­å´ä¸ä¼šæºå¸¦ hashï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†çš„ä¿®æ”¹ä¸ä¼šäº§ç”Ÿ HTTP è¯·æ±‚ï¼Œä½†æ˜¯ä¼šäº§ç”Ÿæµè§ˆå™¨å†å²è®°å½•ï¼Œè¿™å¯¹æˆ‘ä»¬è¿›è¡Œè·¨åŸŸé€šä¿¡ç»™äºˆäº†å¸®åŠ©ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹ URL çš„ hash éƒ¨åˆ†æ¥è¿›è¡ŒåŒå‘é€šä¿¡ã€‚

ç¤ºä¾‹å¦‚ä¸‹ï¼šåŸŸå http://127.0.0.1:9000 é¡µé¢ A é€šè¿‡ `iframe` åµŒå…¥äº† http://127.0.0.1é¡µé¢ B ï¼Œæ¥ä¸‹æ¥é¡µé¢ A å’Œé¡µé¢ B å°†é€šè¿‡ `location.hash` è¿›è¡ŒåŒå‘é€šä¿¡

**é¡µé¢ A ä»£ç **

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>é¡µé¢A</title>
</head>
<body>
  <iframe src="http://127.0.0.1/bop/test.html#locationHash" id="ifr"></iframe>
</body>
</html>
```

**é¡µé¢ B ä»£ç **

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>é¡µé¢B</title>
</head>
<body>
  <h1>hello localtionHash</h2>
</body>
</html>
<script>
try {
  parent.location.hash = 'data';
} catch (e) {
  // ieã€chromeçš„å®‰å…¨æœºåˆ¶æ— æ³•ä¿®æ”¹parent.location.hashï¼Œæ‰€ä»¥è¦å€ŸåŠ©äºçˆ¶çª—å£åŸŸåä¸‹çš„ä¸€ä¸ªä»£ç†iframe
  var $ifrproxy = document.createElement('iframe');
  $ifrproxy.style.display = 'none';
  // æ³¨æ„proxy.htmlå¿…é¡»æ˜¯åŸŸåä¸º http://127.0.0.1:9000 ä¸‹çš„é¡µé¢
  $ifrproxy.src = "http://127.0.0.1:9000/proxy.html#locationHashChange";
  document.body.appendChild($ifrproxy);
}
</script>
```

**ä»£ç†é¡µé¢ä»£ç **

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Proxyé¡µé¢</title>
</head>
<body>
    
</body>
<script>
// å› ä¸ºparent.parentå’Œè‡ªèº«å±äºåŒä¸€ä¸ªåŸŸï¼Œæ‰€ä»¥å¯ä»¥æ”¹å˜å…¶location.hashçš„å€¼
parent.parent.location.hash = self.location.hash.substring(1);
</script>
</html>
```

è¿è¡Œç»“æœå¦‚å›¾

![](/images/blog/0312/hash2.png)

ä»¥ä¸Šå†…å®¹ä¾¿æ˜¯æ–‡ç« çš„æ‰€æœ‰å†…å®¹äº†ï¼Œå¸Œæœ›å¤šå¤šå°‘å°‘å¯ä»¥å¸®åŠ©å°ä¼™ä¼´ä»¬å»æ›´å¥½çš„ç†è§£è·¨åŸŸ
